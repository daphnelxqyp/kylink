# KyAds SuffixPool ç³»ç»Ÿæµç¨‹å›¾

ä¸ºé¡¹ç›®åˆ¶ä½œå°å­¦ç”Ÿéƒ½èƒ½çœ‹æ‡‚çš„ Mermaid æµç¨‹å›¾ï¼Œæ¶µç›–å››ä¸ªæ ¸å¿ƒæ¨¡å—ã€‚

---

## 1. ç³»ç»Ÿå…¨æ™¯å›¾

```mermaid
flowchart TB
    subgraph å¤–éƒ¨["å¤–éƒ¨ç³»ç»Ÿ"]
        Script["Google Ads è„šæœ¬<br/>ï¼ˆå¹¿å‘Šå¹³å°ï¼‰"]
        Sheet["Google è¡¨æ ¼<br/>ï¼ˆæ•°æ®æ¥æºï¼‰"]
        Admin["ç®¡ç†å‘˜<br/>ï¼ˆæ“ä½œåå°ï¼‰"]
    end

    subgraph API["API ç½‘å…³"]
        Auth["API Key è®¤è¯"]
        Session["Session è®¤è¯<br/>ï¼ˆç®¡ç†åå°ï¼‰"]
    end

    subgraph Core["æ ¸å¿ƒä¸šåŠ¡"]
        Lease["ç§Ÿçº¦æœåŠ¡<br/>lease-service"]
        Stock["åº“å­˜æœåŠ¡<br/>stock-producer"]
        Suffix["é“¾æ¥ç”Ÿæˆå™¨<br/>suffix-generator"]
    end

    subgraph Data["æ•°æ®å­˜å‚¨"]
        DB[("MySQL æ•°æ®åº“")]
        Cache["ç‚¹å‡»çŠ¶æ€ç¼“å­˜"]
    end

    subgraph Jobs["å®šæ—¶ä»»åŠ¡"]
        Replenish["åº“å­˜è¡¥è´§<br/>æ¯5åˆ†é’Ÿ"]
        Recovery["ç§Ÿçº¦å›æ”¶<br/>æ¸…ç†è¿‡æœŸ"]
        Alert["å‘Šè­¦æ£€æŸ¥<br/>ç›‘æ§å¼‚å¸¸"]
    end

    Script -->|"1.ä¸ŠæŠ¥ç‚¹å‡»æ•°"| Auth
    Auth -->|"éªŒè¯é€šè¿‡"| Lease
    Lease -->|"åˆ†é…é“¾æ¥"| Stock
    Stock -->|"ç”Ÿæˆæ–°é“¾æ¥"| Suffix
    Lease -->|"è¯»å†™æ•°æ®"| DB
    Stock -->|"è¯»å†™æ•°æ®"| DB

    Script -->|"2.ç¡®è®¤å†™å…¥"| Auth
    Lease -->|"æ›´æ–°çŠ¶æ€"| Cache

    Sheet -->|"å¯¼å…¥æ•°æ®"| Session
    Admin -->|"ç™»å½•ç®¡ç†"| Session
    Session -->|"ç®¡ç†æ“ä½œ"| DB

    Jobs -->|"å®šæ—¶æ‰§è¡Œ"| Stock
    Jobs -->|"æ¸…ç†è¿‡æœŸ"| Lease
    Jobs -->|"æ£€æŸ¥çŠ¶æ€"| DB
```

---

## 2. æ ¸å¿ƒç§Ÿçº¦æµç¨‹ï¼ˆæœ€é‡è¦ï¼‰

### 2.1 è¯·æ±‚ç§Ÿçº¦æµç¨‹

```mermaid
flowchart TD
    Start([å¹¿å‘Šè„šæœ¬å‘èµ·è¯·æ±‚]) --> A1[æºå¸¦ API Key]

    A1 --> A2{API Key æœ‰æ•ˆ?}
    A2 -->|æ— æ•ˆ| E1[è¿”å› 401 æœªæˆæƒ]
    A2 -->|æœ‰æ•ˆ| A3[æå–ç”¨æˆ·ID]

    A3 --> B1{å‚æ•°å®Œæ•´?}
    B1 -->|ç¼ºå°‘å¿…å¡«é¡¹| E2[è¿”å› 422 å‚æ•°é”™è¯¯]
    B1 -->|å®Œæ•´| B2[è§£æè¯·æ±‚æ•°æ®]

    B2 --> C1{ä¹‹å‰è¯·æ±‚è¿‡?<br/>æ£€æŸ¥å¹‚ç­‰æ€§Key}
    C1 -->|æ˜¯-å·²æœ‰ç§Ÿçº¦| C2[è¿”å›ä¹‹å‰çš„ç»“æœ<br/>action=APPLY]
    C1 -->|æ˜¯-ä¹‹å‰æ‹’ç»| C3[è¿”å›ä¹‹å‰çš„ç»“æœ<br/>action=NOOP]
    C1 -->|å¦-é¦–æ¬¡è¯·æ±‚| C4[ç»§ç»­å¤„ç†]

    C4 --> D1{Campaignå­˜åœ¨?}
    D1 -->|ä¸å­˜åœ¨+æœ‰å…ƒæ•°æ®| D2[è‡ªåŠ¨åˆ›å»ºCampaign]
    D1 -->|ä¸å­˜åœ¨+æ— å…ƒæ•°æ®| E3[è¿”å› PENDING_IMPORT<br/>éœ€è¦å…ˆå¯¼å…¥]
    D1 -->|å­˜åœ¨| D3[è·å–Campaignä¿¡æ¯]
    D2 --> D3

    D3 --> E[è·å–ç‚¹å‡»çŠ¶æ€]
    E --> F{è®¡ç®—: æ–°ç‚¹å‡» - ä¸Šæ¬¡ç‚¹å‡»}

    F -->|å·®å€¼ <= 0<br/>æ²¡æœ‰æ–°ç‚¹å‡»| G1[è¿”å› NOOP<br/>ä¸éœ€è¦æ¢é“¾]
    F -->|å·®å€¼ > 0<br/>æœ‰æ–°ç‚¹å‡»| G2[éœ€è¦æ¢é“¾]

    G2 --> H{å·²æœ‰æ´»è·ƒç§Ÿçº¦?}
    H -->|æœ‰| H1[è¿”å›ç°æœ‰ç§Ÿçº¦<br/>å¤ç”¨ä¹‹å‰çš„é“¾æ¥]
    H -->|æ²¡æœ‰| I[ä»åº“å­˜å–é“¾æ¥]

    I --> J{åº“å­˜å……è¶³?}
    J -->|æ²¡æœ‰åº“å­˜| J1[è§¦å‘ç´§æ€¥è¡¥è´§]
    J1 --> E4[è¿”å› 409 NO_STOCK<br/>ç¨åé‡è¯•]
    J -->|æœ‰åº“å­˜| K[åˆ›å»ºæ–°ç§Ÿçº¦]

    K --> L[æ ‡è®°åº“å­˜ä¸ºå·²ç§Ÿå‡º]
    L --> M[å¼‚æ­¥è§¦å‘è¡¥è´§æ£€æŸ¥]
    M --> N([è¿”å›æˆåŠŸ<br/>action=APPLY<br/>å¸¦æ–°é“¾æ¥])

    style Start fill:#e1f5fe
    style N fill:#c8e6c9
    style E1 fill:#ffcdd2
    style E2 fill:#ffcdd2
    style E3 fill:#fff3e0
    style E4 fill:#ffcdd2
    style G1 fill:#fff9c4
    style H1 fill:#c8e6c9
    style C2 fill:#e1bee7
    style C3 fill:#e1bee7
```

### 2.2 ç¡®è®¤ç§Ÿçº¦æµç¨‹ï¼ˆACKï¼‰

```mermaid
flowchart TD
    Start([å¹¿å‘Šè„šæœ¬å‘é€ç¡®è®¤]) --> A[æºå¸¦ç§Ÿçº¦ID]

    A --> B{API Key æœ‰æ•ˆ?}
    B -->|æ— æ•ˆ| E1[è¿”å› 401]
    B -->|æœ‰æ•ˆ| C[æŸ¥æ‰¾ç§Ÿçº¦]

    C --> D{ç§Ÿçº¦å­˜åœ¨?}
    D -->|ä¸å­˜åœ¨| E2[è¿”å› 404 æ‰¾ä¸åˆ°]
    D -->|å­˜åœ¨| E{ä¹‹å‰ç¡®è®¤è¿‡?}

    E -->|æ˜¯| F[è¿”å›ä¹‹å‰çš„ç»“æœ<br/>å¹‚ç­‰å¤„ç†]
    E -->|å¦-é¦–æ¬¡ç¡®è®¤| G{å†™å…¥æˆåŠŸäº†å—?}

    G -->|æˆåŠŸ applied=true| H1[æ›´æ–°ç§Ÿçº¦çŠ¶æ€=å·²æ¶ˆè´¹]
    G -->|å¤±è´¥ applied=false| H2[æ›´æ–°ç§Ÿçº¦çŠ¶æ€=å¤±è´¥<br/>è®°å½•é”™è¯¯åŸå› ]

    H1 --> I1[æ›´æ–°åº“å­˜çŠ¶æ€=å·²æ¶ˆè´¹]
    I1 --> J1[æ›´æ–°ç‚¹å‡»è®¡æ•°<br/>ä½¿ç”¨GREATESTé˜²æ­¢å›é€€]
    J1 --> K([è¿”å›æˆåŠŸ])

    H2 --> K

    style Start fill:#e1f5fe
    style K fill:#c8e6c9
    style E1 fill:#ffcdd2
    style E2 fill:#ffcdd2
    style F fill:#e1bee7
```

---

## 3. åº“å­˜è¡¥è´§æµç¨‹

```mermaid
flowchart TD
    Start([å®šæ—¶ä»»åŠ¡å¯åŠ¨<br/>æ¯5åˆ†é’Ÿ]) --> A[éå†æ‰€æœ‰æ´»è·ƒCampaign]

    A --> B[è®¡ç®—åŠ¨æ€æ°´ä½]

    subgraph WaterMark["åŠ¨æ€æ°´ä½è®¡ç®—"]
        W1[æŸ¥è¯¢è¿‡å»24å°æ—¶æ¶ˆè´¹é‡]
        W1 --> W2{æœ‰æ¶ˆè´¹è®°å½•?}
        W2 -->|æ²¡æœ‰-æ–°Campaign| W3[é»˜è®¤æ°´ä½=5]
        W2 -->|æœ‰è®°å½•| W4[è®¡ç®—æ¯å°æ—¶å¹³å‡æ¶ˆè´¹]
        W4 --> W5[æ°´ä½ = å¹³å‡å€¼ Ã— 2]
        W5 --> W6[é™åˆ¶èŒƒå›´: 3~20]
    end

    B --> WaterMark
    WaterMark --> C[ç»Ÿè®¡å½“å‰å¯ç”¨åº“å­˜]

    C --> D{åº“å­˜ < æ°´ä½?}
    D -->|å¦-åº“å­˜å……è¶³| E1[è·³è¿‡æ­¤Campaign]
    D -->|æ˜¯-éœ€è¦è¡¥è´§| E2[å¼€å§‹ç”Ÿäº§é“¾æ¥]

    E2 --> F{æœ‰è”ç›Ÿé“¾æ¥é…ç½®?}
    F -->|æ²¡æœ‰| G1[è·³è¿‡-æ— æ³•ç”Ÿæˆ]
    F -->|æœ‰| G2[è·å–ä»£ç†æœåŠ¡]

    G2 --> H{ä»£ç†å¯ç”¨?}
    H -->|å¯ç”¨| I1[ä½¿ç”¨çœŸå®ä»£ç†ç”Ÿæˆ]
    H -->|ä¸å¯ç”¨| I2[ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®]

    I1 --> J[å¾ªç¯ç”Ÿæˆ10ä¸ªé“¾æ¥]
    I2 --> J

    J --> K[æ‰¹é‡å†™å…¥æ•°æ®åº“]
    K --> L[è®°å½•å®¡è®¡æ—¥å¿—]
    L --> M{è¿˜æœ‰Campaign?}
    M -->|æœ‰| A
    M -->|æ²¡æœ‰| N([è¡¥è´§å®Œæˆ])

    E1 --> M
    G1 --> M

    style Start fill:#e1f5fe
    style N fill:#c8e6c9
    style E1 fill:#fff9c4
    style G1 fill:#fff9c4
```

### 3.1 åº“å­˜çŠ¶æ€æµè½¬

```mermaid
stateDiagram-v2
    [*] --> å¯ç”¨: è¡¥è´§ç”Ÿæˆ

    å¯ç”¨ --> å·²ç§Ÿå‡º: ç§Ÿçº¦è¯·æ±‚

    å·²ç§Ÿå‡º --> å·²æ¶ˆè´¹: ACKæˆåŠŸ
    å·²ç§Ÿå‡º --> å¤±è´¥: ACKå¤±è´¥
    å·²ç§Ÿå‡º --> è¿‡æœŸ: è¶…æ—¶æœªç¡®è®¤

    å¤±è´¥ --> å¯ç”¨: åå°å›æ”¶
    è¿‡æœŸ --> å¯ç”¨: åå°å›æ”¶

    å·²æ¶ˆè´¹ --> [*]: ç”Ÿå‘½å‘¨æœŸç»“æŸ
```

---

## 4. ç”¨æˆ·è®¤è¯æµç¨‹

### 4.1 API Key è®¤è¯ï¼ˆç»™å¹¿å‘Šè„šæœ¬ç”¨ï¼‰

```mermaid
flowchart TD
    Start([æ”¶åˆ°APIè¯·æ±‚]) --> A[è¯»å–Authorizationå¤´]

    A --> B{æœ‰Authorizationå¤´?}
    B -->|æ²¡æœ‰| E1[è¿”å› 401<br/>ç¼ºå°‘è®¤è¯ä¿¡æ¯]
    B -->|æœ‰| C{ä»¥Bearerå¼€å¤´?}

    C -->|ä¸æ˜¯| E2[è¿”å› 401<br/>æ ¼å¼é”™è¯¯]
    C -->|æ˜¯| D[æå–API Key]

    D --> E{å‰ç¼€æ­£ç¡®?<br/>ky_live_ æˆ– ky_test_}
    E -->|ä¸å¯¹| E3[è¿”å› 401<br/>æ— æ•ˆçš„Key]
    E -->|æ­£ç¡®| F{é•¿åº¦=40å­—ç¬¦?}

    F -->|ä¸å¯¹| E4[è¿”å› 401<br/>Keyé•¿åº¦é”™è¯¯]
    F -->|æ­£ç¡®| G[è®¡ç®—SHA256å“ˆå¸Œ]

    G --> H[æŸ¥è¯¢æ•°æ®åº“<br/>åŒ¹é…å“ˆå¸Œå€¼]

    H --> I{æ‰¾åˆ°ç”¨æˆ·?}
    I -->|æ²¡æ‰¾åˆ°| E5[è¿”å› 401<br/>Keyä¸å­˜åœ¨]
    I -->|æ‰¾åˆ°| J{ç”¨æˆ·è¢«ç¦ç”¨?}

    J -->|æ˜¯| E6[è¿”å› 403<br/>è´¦å·å·²ç¦ç”¨]
    J -->|å¦| K([è®¤è¯æˆåŠŸ<br/>è¿”å›ç”¨æˆ·ID])

    style Start fill:#e1f5fe
    style K fill:#c8e6c9
    style E1 fill:#ffcdd2
    style E2 fill:#ffcdd2
    style E3 fill:#ffcdd2
    style E4 fill:#ffcdd2
    style E5 fill:#ffcdd2
    style E6 fill:#ffcdd2
```

### 4.2 ç®¡ç†åå°ç™»å½•ï¼ˆç»™ç®¡ç†å‘˜ç”¨ï¼‰

```mermaid
flowchart TD
    Start([è®¿é—®ç™»å½•é¡µé¢]) --> A[è¾“å…¥é‚®ç®±å’Œå¯†ç ]

    A --> B{éƒ½å¡«å†™äº†?}
    B -->|æ²¡å¡«å®Œ| E1[æç¤º: è¯·è¾“å…¥é‚®ç®±å’Œå¯†ç ]
    B -->|å¡«å®Œäº†| C[æŸ¥è¯¢æ•°æ®åº“]

    C --> D{ç”¨æˆ·å­˜åœ¨?}
    D -->|ä¸å­˜åœ¨| E2[æç¤º: é‚®ç®±æˆ–å¯†ç é”™è¯¯]
    D -->|å­˜åœ¨| E{ç”¨æˆ·è¢«ç¦ç”¨?}

    E -->|æ˜¯| E3[æç¤º: è´¦å·å·²è¢«ç¦ç”¨]
    E -->|å¦| F[éªŒè¯å¯†ç ]

    F --> G{å¯†ç æ­£ç¡®?}
    G -->|é”™è¯¯| E4[æç¤º: é‚®ç®±æˆ–å¯†ç é”™è¯¯]
    G -->|æ­£ç¡®| H[ç”ŸæˆJWTä»¤ç‰Œ]

    H --> I[è®¾ç½®Session<br/>æœ‰æ•ˆæœŸ30å¤©]
    I --> J([è·³è½¬åˆ°ç®¡ç†åå°])

    style Start fill:#e1f5fe
    style J fill:#c8e6c9
    style E1 fill:#ffcdd2
    style E2 fill:#ffcdd2
    style E3 fill:#ffcdd2
    style E4 fill:#ffcdd2
```

---

## 5. å®Œæ•´ä¸šåŠ¡æ—¶åºå›¾

```mermaid
sequenceDiagram
    participant Script as å¹¿å‘Šè„šæœ¬
    participant API as åç«¯API
    participant DB as æ•°æ®åº“
    participant Stock as åº“å­˜æœåŠ¡
    participant Proxy as ä»£ç†æœåŠ¡

    Note over Script,Proxy: ç¬¬ä¸€é˜¶æ®µï¼šè¯·æ±‚æ–°é“¾æ¥

    Script->>API: 1. è¯·æ±‚ç§Ÿçº¦(campaignId, ç‚¹å‡»æ•°)
    API->>API: éªŒè¯API Key
    API->>DB: æŸ¥è¯¢å¹‚ç­‰æ€§Key
    DB-->>API: æ— é‡å¤
    API->>DB: æŸ¥è¯¢ç‚¹å‡»çŠ¶æ€
    DB-->>API: ä¸Šæ¬¡ç‚¹å‡»æ•°=100
    API->>API: è®¡ç®—å·®å€¼: 120-100=20 > 0
    API->>DB: æŸ¥è¯¢å¯ç”¨åº“å­˜
    DB-->>API: è¿”å›ä¸€æ¡å¯ç”¨é“¾æ¥
    API->>DB: åˆ›å»ºç§Ÿçº¦+æ›´æ–°åº“å­˜çŠ¶æ€
    API-->>Script: è¿”å›æ–°é“¾æ¥

    Note over Script,Proxy: ç¬¬äºŒé˜¶æ®µï¼šç¡®è®¤å†™å…¥

    Script->>Script: å†™å…¥Google Ads
    Script->>API: 2. ç¡®è®¤å†™å…¥(leaseId, æˆåŠŸ)
    API->>DB: æ›´æ–°ç§Ÿçº¦çŠ¶æ€=å·²æ¶ˆè´¹
    API->>DB: æ›´æ–°åº“å­˜çŠ¶æ€=å·²æ¶ˆè´¹
    API->>DB: æ›´æ–°ç‚¹å‡»æ•°=120
    API-->>Script: ç¡®è®¤æˆåŠŸ

    Note over Script,Proxy: ç¬¬ä¸‰é˜¶æ®µï¼šåå°è¡¥è´§

    Stock->>DB: 3. å®šæ—¶æ£€æŸ¥åº“å­˜æ°´ä½
    DB-->>Stock: å½“å‰åº“å­˜=2, æ°´ä½=5
    Stock->>Stock: éœ€è¦è¡¥è´§
    Stock->>Proxy: è¯·æ±‚ç”Ÿæˆé“¾æ¥
    Proxy-->>Stock: è¿”å›æ–°é“¾æ¥
    Stock->>DB: æ‰¹é‡å†™å…¥æ–°åº“å­˜
```

---

## 6. å°å­¦ç”Ÿç‰ˆæœ¬è§£é‡Š

### 6.1 æ•´ä¸ªç³»ç»Ÿåƒä»€ä¹ˆï¼Ÿ

æƒ³è±¡ä¸€ä¸ª**è‡ªåŠ¨æ¢è´´çº¸çš„æœºå™¨**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                 â”‚
â”‚    ğŸ“± å¹¿å‘Šç‰Œ (Google Ads)                       â”‚
â”‚    ä¸Šé¢è´´ç€ä¸€å¼ è´´çº¸ï¼ˆé“¾æ¥ï¼‰                      â”‚
â”‚                                                 â”‚
â”‚         â†“ æœ‰äººçœ‹äº†å¹¿å‘Šï¼ˆç‚¹å‡»ï¼‰                  â”‚
â”‚                                                 â”‚
â”‚    ğŸ¤– æœºå™¨äººæ£€æŸ¥ï¼š                              â”‚
â”‚       "æœ‰æ–°çš„äººçœ‹äº†å—ï¼Ÿ"                        â”‚
â”‚         â†“                                       â”‚
â”‚       â”œâ”€â”€ æ²¡æœ‰æ–°äººçœ‹ â†’ ä¸æ¢è´´çº¸                â”‚
â”‚       â””â”€â”€ æœ‰æ–°äººçœ‹ â†’ æ¢ä¸€å¼ æ–°è´´çº¸              â”‚
â”‚                                                 â”‚
â”‚    ğŸ“¦ è´´çº¸ä»“åº“ï¼š                                â”‚
â”‚       - è‡ªåŠ¨æ£€æŸ¥è¿˜å‰©å¤šå°‘è´´çº¸                    â”‚
â”‚       - å¿«ç”¨å®Œæ—¶è‡ªåŠ¨ç”Ÿäº§æ–°çš„                    â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 ä¸ºä»€ä¹ˆè¦æ¢è´´çº¸ï¼Ÿ

```mermaid
flowchart LR
    A[ç”¨æˆ·ç‚¹å‡»å¹¿å‘Š] --> B[ç³»ç»Ÿè®°å½•ç‚¹å‡»]
    B --> C{ç‚¹å‡»æ•°å˜äº†?}
    C -->|å˜äº†| D[æ¢æ–°è´´çº¸<br/>è¿½è¸ªæ–°ç”¨æˆ·]
    C -->|æ²¡å˜| E[ä¸ç”¨æ¢<br/>çœäº‹]
```

### 6.3 å…³é”®è§„åˆ™ï¼ˆç®€å•ç‰ˆï¼‰

| è§„åˆ™åç§° | å°å­¦ç”Ÿè§£é‡Š |
|---------|-----------|
| **å¹‚ç­‰æ€§** | é—®åŒæ ·çš„é—®é¢˜ï¼Œç»™åŒæ ·çš„ç­”æ¡ˆï¼ˆä¸ä¼šé‡å¤å‘è´´çº¸ï¼‰ |
| **å•ç§Ÿçº¦** | ä¸€æ¬¡åªèƒ½å€Ÿä¸€å¼ è´´çº¸ï¼Œç”¨å®Œè¿˜äº†æ‰èƒ½å€Ÿä¸‹ä¸€å¼  |
| **å•è°ƒé€’å¢** | ç‚¹å‡»æ•°åªèƒ½å˜å¤šï¼Œä¸èƒ½å˜å°‘ï¼ˆé˜²æ­¢ä½œå¼Šï¼‰ |
| **åŠ¨æ€æ°´ä½** | ç”¨å¾—å¿«å°±å¤šå‡†å¤‡ï¼Œç”¨å¾—æ…¢å°±å°‘å‡†å¤‡ï¼ˆä¸æµªè´¹ï¼‰ |

---

## 7. æ•°æ®åº“è¡¨å…³ç³»

```mermaid
erDiagram
    User ||--o{ CampaignMeta : "æ‹¥æœ‰"
    User ||--o{ AffiliateLink : "é…ç½®"
    User ||--o{ SuffixStockItem : "åº“å­˜"
    User ||--o{ SuffixLease : "ç§Ÿçº¦"

    CampaignMeta ||--o| CampaignClickState : "ç‚¹å‡»çŠ¶æ€"
    CampaignMeta ||--o{ SuffixStockItem : "åº“å­˜"
    CampaignMeta ||--o{ SuffixLease : "ç§Ÿçº¦"
    CampaignMeta ||--o{ AffiliateLink : "é“¾æ¥"

    SuffixStockItem ||--o| SuffixLease : "è¢«ç§Ÿç”¨"

    User {
        string id PK
        string email
        string apiKeyHash
        string role
        string status
    }

    CampaignMeta {
        string id PK
        string campaignId
        string country
        string finalUrl
    }

    SuffixStockItem {
        string id PK
        string finalUrlSuffix
        string status
        string exitIp
    }

    SuffixLease {
        string id PK
        string idempotencyKey
        string status
        int nowClicksAtLeaseTime
    }

    CampaignClickState {
        string id PK
        int lastAppliedClicks
        int lastObservedClicks
    }
```

---

## éªŒè¯æ–¹å¼

æµç¨‹å›¾åˆ›å»ºåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ï¼š

1. **åœ¨çº¿é¢„è§ˆ**ï¼šå°† Mermaid ä»£ç ç²˜è´´åˆ° [mermaid.live](https://mermaid.live) æŸ¥çœ‹æ¸²æŸ“æ•ˆæœ

2. **å¯¼å‡ºä¸ºå›¾ç‰‡**ï¼šä½¿ç”¨ Mermaid CLI æˆ–åœ¨çº¿å·¥å…·å¯¼å‡º PNG/SVG

3. **åµŒå…¥æ–‡æ¡£**ï¼šGitHub/GitLab/Notion ç­‰å¹³å°åŸç”Ÿæ”¯æŒ Mermaid æ¸²æŸ“
